<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>Профиль</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
  <style>
    #bar {
      float: left ;
      display: block;
      width: 225px;
      border: 0px;
      margin: 0px;
    }

    #page {
      float: left;
      display: block;
      width: 560px;
      border: 1px;
      margin: 80px;
    }

    .main-container {
      background: #fff;
      width: 250px;
      height: 250px;
      display: block;
    }

    .load-container {
      display: flex;
      position: absolute;
      right: 120px;
      top: 450px;
    }

    .profile {
      display: flex;
      position: absolute;
      right: 140px;
      top: 100px;
    }

    img {
      position: absolute;
      width: 300px;
      height: 300px;
      right: 30px;
      border-radius: 100px;
      background-size: 300px;
    }

    .exit {
      position:absolute;
      bottom:20px;
      left:30px;
    }

  </style>


</head>
<body>
<div id="bar" class="d-flex flex-column flex-shrink-0 p-3 text-bg-dark" style=" height: 1300px">
  <a th:href="@{'/profile/{id}'(id=${userId})}" class="d-flex align-items-center mb-3 mb-md-0 me-md-auto text-white text-decoration-none">
    <svg class="bi pe-none me-2" width="35" height="32"></svg>
    <span class="fs-4">Профиль</span>
  </a>
  <hr>
  <a th:href="@{'/patients/{id}'(id=${userId})}" class="d-flex align-items-center mb-3 mb-md-0 me-md-auto text-white text-decoration-none">
    <svg class="bi pe-none me-2" width="35" height="32"></svg>
    <span class="fs-4">Пациенты</span>
  </a>
  <hr>
  <a href="/sign" class="align-items-center text-white text-decoration-none exit">
    <svg class="bi pe-none me-2" width="35" height="32"></svg>
    <span class="fs-6">Выйти</span>
  </a>
</div>



<div id="page" class="d-flex flex-column flex-shrink-0 col-md-7 col-lg-8">
  <h4 class="mb-3">Пациенты</h4>

  <errors path="patients"></errors>
  [[${noClientsErrors}]]
<form action="/patients" method="post" modelAttribute="documentsForm">

  <tr th:each="patient : ${patients}">
    <div class="list-group mx-0 w-auto">
      <label class="list-group-item d-flex gap-2">
        <div>
          <input type="hidden" id="docid" th:value="${userId}">
          <input type="hidden" id="clientid" th:value="${patient.id}">

          <br>

          <td><b th:text="${patient.email}"></b>
          </td>
          <br>

          <td>Последний приём: <span th:text="${patient.lastdate}"></span>  <span th:text="${patient.lasttime}"></span></td>
          <br>
          <td>Следующий приём: <span th:text="${patient.futuredate}"></span>  <span th:text="${patient.futuretime}"></span></td>



          <div >
            <br>
            <input id="fileupload" type="file" name="document"/>
            <button class = "btn btn-primary" id="upload-button" onclick="uploadFiles()"> Загрузить </button>
          </div>
          <script>
            async function uploadFiles() {
              let filename = fileupload.files[0].name
              let formData = new FormData();
              formData.append("file", fileupload.files[0]);
              await fetch('/upload-image', {
                        method: "POST",
                        body: formData
                      },
              );

              let file = new FormData();
              file.append("doc", fileupload.files[0].name);
              file.append("docid", document.getElementById("docid"));
              file.append("client", document.getElementById("clientid"));
              if (image != null) {
                await fetch('/add-file', {
                  method: "POST",
                  body: file
                });

              }
              alert('Документ успешно загружен');
            }
          </script>
          <br>

        </div>
      </label>

    </div>

    <br>
  </tr>
</form>


</div>



</body>
</html>